<section class="home-page">
  <!-- TOP LEFT: Hero Text + Icon -->
  <header class="home-header">
    <div class="home-hero">
      <h1 class="home-hero__title">Where Winds Meet Helper</h1>
      <p class="home-hero__subtitle text-muted-strong">
        Keep your daily, weekly and seasonal tasks organised with live timers, guides and tools so
        every login feels efficient.
      </p>
    </div>

    <div class="home-logo">
      <img src="assets/portal/wwm-wheat-256.png" alt="Where Winds Meet" class="home-logo-img" />
    </div>
  </header>

  <!-- RIGHT COLUMN: Timers + Resources -->
  <aside class="home-sidebar">
    <!-- Next Resets & Events -->
    <article class="home-card card-surface card-padding">
      <header class="home-card-header">
        <div>
          <h2>Next resets & events</h2>
          <p class="home-card-subtitle text-muted-strong">Closest timers and active windows.</p>
        </div>
        <a class="home-card-link" [routerLink]="['/timers']">View all</a>
      </header>

      <div class="home-card-body">
        @if (upcomingTimers().length > 0) {
          <ul class="home-timer-list">
            @for (timer of upcomingTimers(); track timer.id) {
              <li
                class="home-timer-item"
                [class.home-timer-item--active]="timer.state.type === 'active'"
                [class.home-timer-item--warning]="
                  timer.state.type === 'warning' || timer.state.type === 'urgent'
                "
                [ngStyle]="timer.warningStyle"
              >
                <div class="home-timer-main">
                  <i class="home-timer-icon {{ timer.icon }}"></i>
                  <span class="home-timer-label">{{ timer.label }}</span>
                  @if (timer.isActive) {
                    <span class="home-timer-badge home-timer-badge--active">Active</span>
                  }
                  @if (timer.isEvent) {
                    <span class="home-timer-badge home-timer-badge--event">Event</span>
                  }
                </div>
                <span class="home-timer-countdown">{{ timer.remaining }}</span>
              </li>
            }
          </ul>
        } @else {
          <div class="home-empty-state text-muted-strong">
            All timers shown in the strip above. Add more from the timers page.
          </div>
        }
      </div>
    </article>

    <!-- Resources -->
    <article class="home-card card-surface card-padding home-card--resources">
      <header class="home-card-header">
        <div>
          <h2>External resources</h2>
          <p class="home-card-subtitle text-muted-strong">Official and community links.</p>
        </div>
      </header>

      <div class="home-card-body">
        <ul class="home-resources">
          @for (link of resourceLinks; track link.href) {
            <li>
              <a
                class="home-resource-link"
                [href]="link.href"
                target="_blank"
                rel="noopener noreferrer"
              >
                {{ link.label }}
              </a>
            </li>
          }
        </ul>
      </div>
    </article>
  </aside>

  <!-- BOTTOM LEFT: Pinned Checklist Items -->
  <section class="home-pinned">
    <header class="home-card-header">
      <div>
        <h2>Pinned checklist items</h2>
        <p class="home-card-subtitle text-muted-strong">
          Your priority tasks for this cycle. Pin items from the checklist page.
        </p>
      </div>
      <a class="home-card-link" [routerLink]="['/checklist']" [queryParams]="{ tab: 'daily' }">
        Open checklist
      </a>
    </header>

    @if (hasPinnedItems()) {
      <div class="home-pinned-buckets">
        <!-- Side-by-side layout for Daily + Weekly -->
        @if (hasDailyAndWeekly()) {
          <div class="home-pinned-row">
            @if (dailyBucket(); as daily) {
              <div class="home-pinned-bucket home-pinned-bucket--half">
                <h3 class="home-pinned-bucket-title">{{ daily.label }}</h3>
                <ul class="home-pinned-list home-pinned-list--single-col">
                  @for (item of daily.items; track item.id) {
                    <li
                      class="home-pinned-item"
                      [class.home-pinned-item--custom]="item.isCustom"
                      [class.home-pinned-item--checked]="isChecked(item)"
                    >
                      <app-checklist-toggle
                        [checked]="isChecked(item)"
                        (checkedChange)="onToggleItem($event, item)"
                      >
                        <span class="checklist-item-label">
                          {{ item.label }}
                          @if (item.route) {
                            <button
                              type="button"
                              class="guide-link guide-link--compact"
                              (click)="navigateToGuide(item); $event.stopPropagation()"
                              [attr.title]="'Open guide' + (item.section ? ' (go to section)' : '')"
                              aria-label="Open guide"
                            >
                              <i class="bi bi-book"></i>
                            </button>
                          }
                        </span>
                      </app-checklist-toggle>
                    </li>
                  }
                </ul>
              </div>
            }
            @if (weeklyBucket(); as weekly) {
              <div class="home-pinned-bucket home-pinned-bucket--half">
                <h3 class="home-pinned-bucket-title">{{ weekly.label }}</h3>
                <ul class="home-pinned-list home-pinned-list--single-col">
                  @for (item of weekly.items; track item.id) {
                    <li
                      class="home-pinned-item"
                      [class.home-pinned-item--custom]="item.isCustom"
                      [class.home-pinned-item--checked]="isChecked(item)"
                    >
                      <app-checklist-toggle
                        [checked]="isChecked(item)"
                        (checkedChange)="onToggleItem($event, item)"
                      >
                        <span class="checklist-item-label">
                          {{ item.label }}
                          @if (item.route) {
                            <button
                              type="button"
                              class="guide-link guide-link--compact"
                              (click)="navigateToGuide(item); $event.stopPropagation()"
                              [attr.title]="'Open guide' + (item.section ? ' (go to section)' : '')"
                              aria-label="Open guide"
                            >
                              <i class="bi bi-book"></i>
                            </button>
                          }
                        </span>
                      </app-checklist-toggle>
                    </li>
                  }
                </ul>
              </div>
            }
          </div>
          <!-- Seasonal bucket below the side-by-side row -->
          @if (seasonalBucket(); as seasonal) {
            <div class="home-pinned-bucket">
              <h3 class="home-pinned-bucket-title">{{ seasonal.label }}</h3>
              <ul class="home-pinned-list">
                @for (item of seasonal.items; track item.id) {
                  <li
                    class="home-pinned-item"
                    [class.home-pinned-item--custom]="item.isCustom"
                    [class.home-pinned-item--checked]="isChecked(item)"
                  >
                    <app-checklist-toggle
                      [checked]="isChecked(item)"
                      (checkedChange)="onToggleItem($event, item)"
                    >
                      <span class="checklist-item-label">
                        {{ item.label }}
                        @if (item.route) {
                          <button
                            type="button"
                            class="guide-link guide-link--compact"
                            (click)="navigateToGuide(item); $event.stopPropagation()"
                            [attr.title]="'Open guide' + (item.section ? ' (go to section)' : '')"
                            aria-label="Open guide"
                          >
                            <i class="bi bi-book"></i>
                          </button>
                        }
                      </span>
                    </app-checklist-toggle>
                  </li>
                }
              </ul>
            </div>
          }
        } @else {
          <!-- Single-column layout (only one of daily/weekly, or seasonal only) -->
          @for (bucket of singleColumnBuckets(); track bucket.id) {
            <div class="home-pinned-bucket">
              <h3 class="home-pinned-bucket-title">{{ bucket.label }}</h3>
              <ul class="home-pinned-list">
                @for (item of bucket.items; track item.id) {
                  <li
                    class="home-pinned-item"
                    [class.home-pinned-item--custom]="item.isCustom"
                    [class.home-pinned-item--checked]="isChecked(item)"
                  >
                    <app-checklist-toggle
                      [checked]="isChecked(item)"
                      (checkedChange)="onToggleItem($event, item)"
                    >
                      <span class="checklist-item-label">
                        {{ item.label }}
                        @if (item.route) {
                          <button
                            type="button"
                            class="guide-link guide-link--compact"
                            (click)="navigateToGuide(item); $event.stopPropagation()"
                            [attr.title]="'Open guide' + (item.section ? ' (go to section)' : '')"
                            aria-label="Open guide"
                          >
                            <i class="bi bi-book"></i>
                          </button>
                        }
                      </span>
                    </app-checklist-toggle>
                  </li>
                }
              </ul>
            </div>
          }
        }
      </div>
    } @else {
      <div class="home-empty-state text-muted-strong">
        <p>No pinned items yet or any pinned incomplete checklist items.</p>
        <p>
          Use the
          <i class="bi bi-pin-angle"></i>
          icon on the checklist page to pin tasks you want to track here.
        </p>
      </div>
    }
  </section>
</section>
