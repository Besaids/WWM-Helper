<section class="home-page">
  <!-- Hero -->
  <section class="home-hero card-surface card-padding">
    <div class="home-hero-text">
      <h1>Where Winds Meet Helper</h1>
      <p class="home-hero-subtitle text-muted-strong">
        Lightweight companion for your WWM routine. Timers, checklists and guides in one place so
        you can plan sessions without juggling spreadsheets or screenshots.
      </p>
    </div>
  </section>

  <!-- NEW: Upcoming Timers + Pinned Tasks Grid -->
  @if (upcomingTimers$ | async; as upcomingTimers) {
    @if (upcomingTimers.length > 0) {
      <section class="home-highlights-grid">
        <!-- Upcoming Timers -->
        <article class="home-card card-surface card-padding">
          <header class="home-card-header">
            <div>
              <h2>Upcoming events</h2>
              <p class="home-card-subtitle text-muted-strong">
                Next timers and currently active windows.
              </p>
            </div>
            <a class="home-card-link" [routerLink]="['/timers']">View all</a>
          </header>

          <div class="home-card-body">
            <ul class="home-timer-list">
              @for (timer of upcomingTimers; track timer.id) {
                <li class="home-timer-item">
                  <div class="home-timer-main">
                    <i class="home-timer-icon {{ timer.icon }}"></i>
                    <span class="home-timer-label">{{ timer.label }}</span>
                    @if (timer.isActive) {
                      <span class="home-timer-badge home-timer-badge--active">Active</span>
                    }
                  </div>
                  <span class="home-timer-countdown">{{ timer.remaining }}</span>
                </li>
              }
            </ul>
          </div>
        </article>

        <!-- Pinned Tasks - Always rendered -->
        <article class="home-card card-surface card-padding">
          <header class="home-card-header">
            <div>
              <h2>Pinned tasks</h2>
              <p class="home-card-subtitle text-muted-strong">
                Your priority checklist items for this cycle.
              </p>
            </div>
            <a
              class="home-card-link"
              [routerLink]="['/checklist']"
              [queryParams]="{ tab: 'daily' }"
            >
              Open checklist
            </a>
          </header>

          <div class="home-card-body home-card-body--pinned">
            @if (hasPinnedItems) {
              <!-- Daily pinned -->
              @if (pinnedDaily.length > 0) {
                <div class="home-pinned-section">
                  <h3 class="home-pinned-heading">Daily</h3>
                  <ul class="home-pinned-list">
                    @for (item of pinnedDaily; track item.id) {
                      <li class="home-pinned-item">
                        <app-checklist-toggle
                          [checked]="isChecked(item)"
                          (checkedChange)="onToggleItem($event, item)"
                        >
                          <span class="checklist-item-label">{{ item.label }}</span>
                        </app-checklist-toggle>
                      </li>
                    }
                  </ul>
                </div>
              }

              <!-- Weekly pinned -->
              @if (pinnedWeekly.length > 0) {
                <div class="home-pinned-section">
                  <h3 class="home-pinned-heading">Weekly</h3>
                  <ul class="home-pinned-list">
                    @for (item of pinnedWeekly; track item.id) {
                      <li class="home-pinned-item">
                        <app-checklist-toggle
                          [checked]="isChecked(item)"
                          (checkedChange)="onToggleItem($event, item)"
                        >
                          <span class="checklist-item-label">{{ item.label }}</span>
                        </app-checklist-toggle>
                      </li>
                    }
                  </ul>
                </div>
              }
            } @else {
              <div class="home-pinned-empty text-muted-strong">
                No pinned tasks yet. Pin items in the checklist to see them here.
              </div>
            }
          </div>
        </article>
      </section>
    }
  }

  <!-- Section cards -->
  <section class="home-grid">
    @for (section of sections; track section.id) {
      <article class="home-card card-surface card-padding">
        <header class="home-card-header">
          <div>
            <h2>{{ section.title }}</h2>
            <p class="home-card-subtitle text-muted-strong">
              {{ section.subtitle }}
            </p>
          </div>
          <a
            class="home-card-link"
            [routerLink]="section.routerLink"
            [queryParams]="section.id === 'checklist' ? { tab: 'daily' } : null"
          >
            {{ section.ctaLabel }}
          </a>
        </header>

        <div class="home-card-body">
          <ul class="home-list">
            @for (item of section.items; track item.label) {
              <li class="home-list-item">
                <div class="home-list-main">
                  <span class="home-list-label">{{ item.label }}</span>
                </div>
                @if (item.description) {
                  <p class="home-list-description text-muted-strong">
                    {{ item.description }}
                  </p>
                }
              </li>
            }
          </ul>
        </div>
      </article>
    }

    <!-- Guides/resources card -->
    <article class="home-card card-surface card-padding home-card--resources">
      <header class="home-card-header">
        <div>
          <h2>External resources</h2>
          <p class="home-card-subtitle text-muted-strong">
            Official and community links if you want to dig deeper outside this site.
          </p>
        </div>
      </header>

      <div class="home-card-body home-card-body--resources">
        <ul class="home-resources">
          @for (link of resourceLinks; track link.href) {
            <li>
              <a
                class="home-resource-link"
                [href]="link.href"
                target="_blank"
                rel="noopener noreferrer"
              >
                {{ link.label }}
              </a>
            </li>
          }
        </ul>
      </div>
    </article>
  </section>
</section>
